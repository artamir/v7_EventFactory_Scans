//*******************************************************
//*********************  ќѕ»—јЌ»≈  **********************
//*******************************************************

//
//  ласс 1—++ (¬нешний отчет/обработка дл€ 1—:ѕредпри€тие 7.7)
//
// ѕодсистема "—каны доков" v 2.0
// 
// ѕозвол€ет, с минимальными изменени€ми конфы, получить возможность
// в любых документах любой конфигурации добавл€ть/хранить 
// их электронные сканированные копии в любом количестве (на отдельной 
// вкладке дока, генерируемой программно), а соответственно,
// и просматривать/печатать их из форм документов с этой отдельной вкладки.
// ” всех документов по€вл€етс€ дополнительна€ вкладка (создаетс€ программно),
// с названием "—каны", с которой и можно манипулировать пользователю
// сканами, добавл€ть новые картинки или удал€ть. ѕросматривать
// во внешнем приложении (каком-нибудь граф. редакторе ассоциированном с 
// расширением файла-скана) и печатать из этого внешнено приложени€.
// 
// јвтор: ¬енгер јлександр, ќдесса, 2010 [http://venger.narod.ru]
//
// »спользуютс€ внешние компоненты:
//   1—++ [http://www.1cpp.ru] и 
//   FormEx [http://www.dorex.ru]
// —качать свежие версии 1cpp.dll и formex.dll можно тут:
//    1cpp.dll:  http://www.1cpp.ru/images/3/32/Icpp-latest.rar
//    formex.dll:  http://www.dorex.ru/files/?formex_t.zip
//  идаем их в каталог с базой, либо в папку \Bin основной 
// программы и в глобальном модуле в процедуре 
// "ѕриЌачале–аботы—истемы()" пишем две строчки:
//	  «агрузить¬нешнюю омпоненту("1cpp.dll"); 
//	  «агрузить¬нешнюю омпоненту("formex.dll");
//
// Ќеобходима предварительна€ установка подсистемы "‘абрика событий".
// ћожно найти и скачать на сайте: http://venger.narod.ru
// »ли в моем профиле тут: http://infostart.ru/profile/20743/
//
// ѕодключаетс€ вставкой таких строк в глобальный модуль в 
// процедуру "ѕриЌачале–аботы—истемы()", после кода загрузки
// внешних компонент (и после кода подключени€ подсистемы "‘абрика событий"):
//  [ѕредполагаемый код подключени€ подсистемы "‘абрика событий"]
// 		__Settings1cpp__=—оздатьќбъект("SettingsManager");
// 		__Settings1cpp__.Set("EnableHookEventsGroupContext",1);
// 		__ѕерехватчик__=—оздатьќбъект("ѕерехватчик"); 	
// 		__ѕерехватчик__.—н€тьѕерехват—обытий√лобальногоћодул€();
//		__ ласс‘абрика—обытий__=—оздатьќбъект("__ ласс‘абрика—обытий__");
//		__ѕерехватчик__.ѕерехватить—обыти€√лобальногоћодул€(__ ласс‘абрика—обытий__);
//  [-----------------------------------------------------------]
//
//		__ лассѕодсистемы—каныƒоков__=—оздатьќбъект("__ лассѕодсистемы—каныƒоков__");
//		__ лассѕодсистемы—каныƒоков__.ƒобавитьƒоп√лобћодуль();
//		__ лассѕодсистемы—каныƒоков__.ѕодписать лассЌа—обыти€‘абрики(__ ласс‘абрика—обытий__);
//
//
// ѕредполагаетс€ наличие в конфигурации (есть в предлагаемой md'шке):
//   а) ќбъ€влени€ этого класса в обработке "defcls":
//			//# класс __ лассѕодсистемы—каныƒоков__ = __ лассѕодсистемы—каныƒоков__@MD
//			//# {};
//   б) ќпределени€ этого класса в обработке "__ лассѕодсистемы—каныƒоков__",
//      т.е. фактически наличие кода этого класса в конфе в обработке с
//      именем "__ лассѕодсистемы—каныƒоков__"
//   в) ќбъекта-ƒокумента в метаданных "__—каныƒоков__", который используетс€ как
//      контейнер дл€ хранени€ сканов документов. Ёто сугубо служебный док, без
//      кода, форм и т.п. –еквизиты шапки: "ƒок" - тип "ƒокумент". –еквизиты
//      табличной части: "»м€" - тип "—трока", 50; "ѕуть" - тип "—трока", 255.
//   г) ќбработки "__”борщик—канов__", котора€ по кнопке "¬ыполнить" выполн€ет
//      примерно такой код:
//			≈сли ¬опрос("Ёто может зан€ть продолжительное врем€. ѕродолжить?",1)=1 “огда
//				__об__—каныƒоков__=—оздатьќбъект("__ лассѕодсистемы—каныƒоков__"); 
//				__об__—каныƒоков__.—жатьѕапку—канов();
//				__об__—каныƒоков__=0;
//			 онец≈сли;
//

//*******************************************************
//********************  ќЅЏя¬Ћ≈Ќ»я  *********************
//*******************************************************

//-------------------------------------------------------
ѕерем  онтекст‘ормы Ёкспорт;
ѕерем  онт‘ормы;
ѕерем »д ласса,»д√лоб‘ункции,»д¬идаƒоковƒл€—канов,»д—ло€,»д¬кладки,»м€¬кладки,
		»д“«—канов,»д нќбновить,»д нЌовый,»д н”далить,»д н–едактировать,»д нѕросмотр,»д“екстјвтор,
		»м€ѕапкиƒл€—канов; 
		
ѕерем »д артинки, »д“екст“екуща€—трока“«;
ѕерем —луч„исло;

ѕерем Ќомерƒоп√лћодул€;

ѕерем “ќ _ќтладка Ёкспорт; //+(MA)@TOC, 2020.12.06 [‘абрика событий]

//------------------¬нешний интерфейс--------------------
// ћетод подключает доп. глобальный модуль.
// ≈го надо вызывать в глоб. модуле в процедуре "ѕриЌачале–аботы—истемы()":
//	__ лассѕодсистемы—каныƒоков__=—оздатьќбъект("__ лассѕодсистемы—каныƒоков__");
//	__ лассѕодсистемы—каныƒоков__.ƒобавитьƒоп√лобћодуль();
‘ункци€ ƒобавитьƒоп√лобћодуль() Ёкспорт ƒалее

// ”борщик файлов в папке со сканами
// ‘ункци€ перебирает файлы в папке
// и если в базе в доках сканов такого нет,
// то удал€ет его, вывод€ сообщение.
// Ќужна из-за того, что после удалени€
// помеченных на удаление объектов штатными средствами
// документы сканов доков удал€ютс€, а файлы нет.
// ¬от те файлы, что не были удалены при выполнении
// обработки удалени€ помеченных объектов из базы,
// и будут удалены.
‘ункци€ —жатьѕапку—канов() Ёкспорт ƒалее

// ћетод включает перехват событий контекста переданной формы
//ѕроцедура ¬ключитьѕерехват—обытий√ ( онт = "") Ёкспорт ƒалее

//-------------‘ормулы контролов на доп. вкладке---------
‘ункци€ ѕросмотр—кана»з“«—кановƒоковЌа‘орме( онт,»дјтр) Ёкспорт ƒалее
‘ункци€ –едактировать—кан»з“«—кановƒоковЌа‘орме( онт,»дјтр) Ёкспорт ƒалее
‘ункци€ ”далить—кан»з“«—кановƒоковЌа‘орме( онт,»дјтр) Ёкспорт ƒалее
‘ункци€ Ќовый—кан¬“«—кановƒоковЌа‘орме( онт,»дјтр) Ёкспорт ƒалее
‘ункци€ ќбновить“«—кановƒоковЌа‘орме( онт,»дјтр) Ёкспорт ƒалее

//-------------—лужебные процедуры и функции-------------
‘ункци€ GetThis( онт) ƒалее

‘ункци€ ≈стьѕодчиненныеƒоки—канов”ƒока(ƒок) ƒалее

‘ункци€ —лоиѕолучить—писок( онт,“олько¬идимые=0) ƒалее
‘ункци€ «акладки ол¬о( онт) ƒалее
‘ункци€ «акладки¬ключены( онт) ƒалее

‘ункци€ ѕеревод»зƒес€тичной¬–имскую—истему—числени€(«нач „ислоƒл€ѕеревода) ƒалее
‘ункци€ ѕеревод»зѕроизвольной—истемы—числени€¬ƒес€тичную(«нач —трокаƒл€ѕеревода, «нач ќснование„исла=2, «нач ѕогрешность=0) ƒалее

//======================================================================
ѕроцедура “ќ _ќтладка»нициализаци€() Ёкспорт
	“ќ _ќтладка = —оздатьќбъект("“ќ .ќтладка");
	“ќ _ќтладка.–ежимќтладки = 1;
	“ќ _ќтладка.ѕредупреждать = 0;
 онецѕроцедуры // “ќ _ќтладка»нициализаци€


//-------------------------------------------------------
ѕроцедура  онструктор()
	
	“ќ _ќтладка»нициализаци€();
	
	»д ласса="__ лассѕодсистемы—каныƒоков__"; // ¬ коде глоб. модул€ при подключении и коде обработки уборщика, в пофигаторе им€ обработки и объ€влени€ класса
	»д√лоб‘ункции="__гл__‘ормула онтроловЌа‘ормеƒл€—кановƒоков__";
	»д¬идаƒоковƒл€—канов="__—каныƒоков__"; // » в пофигаторе, вид дока переименовать
	»д—ло€="__—каны__";
	»д¬кладки="__—каны__";
	»м€¬кладки="— јЌџ";
	»д“«—канов="__фд_тз—каны__";
	»д нќбновить="__фд_кнќбновить—каны__";
	»д нЌовый="__фд_кнЌовый—кан__";
	»д н”далить="__фд_кн”далить—кан__";
	»д н–едактировать="__фд_кн–едактировать—кан__";
	»д нѕросмотр="__фд_кнѕросмотр—кана__";
	»д“екстјвтор="__фд_текстјвтор__";
	»м€ѕапкиƒл€—канов= аталог»Ѕ()+"__DocsScans__";
	
	»д артинки = "__фд_»зображение__";
	»д“екст“екуща€—трока“« = "__фд_текст“екуща€—трока“«__";
	
	—луч„исло = _GetPerformanceCounter();

 онецѕроцедуры	//  онструктор
//-------------------------------------------------------

//======================================================================
‘ункци€ Ётоƒокумент(ќбъект, “ек—сылка = "")
	–ез = 0;
	ѕопытка 
		“ек—сылка = ќбъект.“екущийƒокумент(); 
		–ез = 1
	»сключение 
		“ек—сылка = "";
	 онецѕопытки;
	
	¬озврат –ез;
 онец‘ункции // Ётоƒокумент

//======================================================================
‘ункци€ Ёто—правочник(ќбъект, “ек—сылка = "")
	–ез = 0;
	ѕопытка 
		“ек—сылка = ќбъект.“екущийЁлемент(); 
		–ез = 1
	»сключение 
		“ек—сылка = "";
	 онецѕопытки;
	
	¬озврат –ез;
 онец‘ункции // Ётоƒокумент

//======================================================================
‘ункци€ ѕолучить—сылку(ќбъект)
	“ек—сылка = "";
	Ётоƒокумент(ќбъект, “ек—сылка);
	≈сли “ек—сылка = "" “огда
		Ёто—правочник(ќбъект, “ек—сылка);
	 онец≈сли;			
	
	¬озврат “ек—сылка;
 онец‘ункции // ѕолучить—сылку
//======================================================================
‘ункци€ ѕолучитьѕодчиненныйƒок—кановќбъекта(ќбъект)
	фн = "ѕолучитьѕодчиненныйƒок—кановќбъекта";
	“ќ _ќтладка.о(фн);
	
	“ек—сылка = ѕолучить—сылку(ќбъект);
	≈сли “ек—сылка = "" “огда
		“ќ _ќтладка.з(фн + " ::::: 1");
		¬озврат "";
	 онец≈сли;
	
	“ќ _ќтладка.—оо("перед созданием ѕр€мой«апрос");
	ѕр€мой«апрос = —оздатьќбъект("ѕр€мой«апрос");
	“ќ _ќтладка.—оо("—оздан ѕр€мой«апрос");
	
		ѕр€мой«апрос.“екст = "
		|выбрать $скан.“екущийƒокумент как [“екƒокумент $ƒокумент.__—каныƒоков__]  
		|из ƒокумент.__—каныƒоков__ как скан
		|где $скан.спр = :ќбъект~
		|объединить
		|выбрать $скан.“екущийƒокумент как [“екƒокумент $ƒокумент.__—каныƒоков__]  
		|из ƒокумент.__—каныƒоков__ как скан
		|где $скан.док = :ќбъект~";
		
	ѕр€мой«апрос.”становить“екстовыйѕараметр("ќбъект", “ек—сылка);
	“ќ _ќтладка.—оо("”становить“екстовыйѕараметр");
	
	итз = ѕр€мой«апрос.¬ыполнить();
	“ќ _ќтладка.—оо("ѕр€мой«апрос.¬ыполнить");
	
	≈сли итз. оличество—трок() = 0 “огда
		“ќ _ќтладка.з(фн + " ::::: 2");
		¬озврат "";
	 онец≈сли;
	
	итз.Ќомер—троки = 1;
	
	“ќ _ќтладка.з(фн);
	¬озврат итз.“екƒокумент;
	
 онец‘ункции // ѕолучитьѕодчиненныйƒок—кановќбъекта
//======================================================================
‘ункци€ ≈стьѕодчиненныеƒоки—канов”ќбъекта(ќбъект)
	“екƒок—кан = ѕолучитьѕодчиненныйƒок—кановќбъекта(ќбъект);
	¬озврат ?(“екƒок—кан = "",0,1);	
 онец‘ункции // ≈стьѕодчиненныеƒоки—канов”ќбъекта



//-------------------------------------------------------
‘ункци€ —обытие√ћ_ѕриќткрытии( онт, ‘лаг„тени€Ќастройки) Ёкспорт
	фн = "—обытие√ћ_ѕриќткрытии";
	“ќ _ќтладка.о(фн);
	–ез=1;
	
	‘орма–асш = —оздатьќбъект("–асширение‘ормы"); 
	‘орма–асш.”становить‘орму( онт.‘орма);
	≈сли Ќайти(‘орма–асш.ѕолный“ипќбъекта(),"ƒокумент.")>0 “огда
		≈сли Ќайти(‘орма–асш.ѕолный“ипќбъекта(),"—каныƒоков")<1 “огда
		»наче
			ѕредупреждение("Ёто служебный документ",5);
			–ез=0;
		 онец≈сли;
	 онец≈сли;
	
	≈сли “ип«начени€—тр( онт) = "√рупповой онтекст" “огда
		 онт‘ормы =  онт;
	 онец≈сли;		
	 онт.‘орма.»спользовать«акладки(1);
	
	“ќ _ќтладка.з(фн);
	¬озврат –ез;
 онец‘ункции  // ‘—_—обытие√ћ_ѕриќткрытии
//-------------------------------------------------------

//-------------------------------------------------------
‘ункци€ ѕослеќткрыти€_—озданиеЁлементов‘ормы() Ёкспорт
	
	фн = "ѕослеќткрыти€_—озданиеЁлементов‘ормы";
	“ќ _ќтладка.о(фн);
	
	 онтќбъекта =  онтекст‘ормы;//GetThis( онтекст).ѕолучить онтекстќкружени€();
	≈сли “ип«начени€—тр( онтќбъекта) <> "√рупповой онтекст" “огда
		≈сли “ип«начени€—тр( онт‘ормы) = "√рупповой онтекст" “огда
			 онтќбъекта=  онт‘ормы;		
		»наче
			“ќ _ќтладка.з(фн + " ::::: 1");
			¬озврат 1;
		 онец≈сли;
	 онец≈сли;


	“екќбъект = ѕолучить—сылку( онтќбъекта);
	≈сли “екќбъект = "" “огда
		“ќ _ќтладка.з(фн + " ::::: 2");
		¬озврат 1;
	 онец≈сли;

	
	‘орма–асш = —оздатьќбъект("–асширение‘ормы"); 
	‘орма–асш.”становить‘орму( онтќбъекта.‘орма);
	“ќ _ќтладка.—оо("‘орма–асш :: " + ‘орма–асш.ѕолный“ипќбъекта());
	
	≈сли «акладки¬ключены( онтќбъекта)<=0 “огда
		 онтќбъекта.‘орма.»спользовать«акладки(1);
	 онец≈сли;
	“ќ _ќтладка.—оо("«акладки¬ключены :: " + «акладки¬ключены( онтќбъекта));
	
	≈сли «акладки ол¬о( онтќбъекта)<=0 “огда
		—п—лои=—лоиѕолучить—писок( онтќбъекта,0);
		Ќазв«акладки=—п—лои.ѕолучить«начение(1);
		 онтќбъекта.‘орма.«акладки.ƒобавить«начение(Ќазв«акладки,Ќазв«акладки);		
	 онец≈сли;
	“ќ _ќтладка.—оо("«акладки ол¬о :: " + «акладки ол¬о( онтќбъекта));
	
	≈сли ≈стьѕодчиненныеƒоки—канов”ќбъекта(“екќбъект)>0 “огда
		 онтќбъекта.‘орма.«акладки.ƒобавить«начение(»д¬кладки,"(!) "+»м€¬кладки);
	»наче
		 онтќбъекта.‘орма.«акладки.ƒобавить«начение(»д¬кладки,»м€¬кладки);	
	 онец≈сли;
	“ќ _ќтладка.—оо("≈стьѕодчиненныеƒоки—канов”ќбъекта :: " + ≈стьѕодчиненныеƒоки—канов”ќбъекта(“екќбъект));
	
	// ‘ормируем полностью программно слой "—каны",
	// т.е. контролы, со всеми функци€ми реакции, 
	// заполненные данными, если есть, и скрываем его.
	Ўирина‘=‘орма–асш.Ўирина;	
	¬ысота‘=‘орма–асш.¬ысота;
	
	‘лагƒоступности онтролов=1;
	‘лагƒоступности онтролов=?( онтќбъекта.‘орма.“олькоѕросмотр()=1,0,1);
	≈сли ‘лагƒоступности онтролов<>0 “огда
		//‘лагƒоступности онтролов=ѕравоƒоступа(" орректировка",""+“ип«начени€—тр(“екƒок)+"."+“екƒок.¬ид());	
	 онец≈сли;
	≈сли ‘лагƒоступности онтролов<>0 “огда

		//-(MA)@TOC, [‘абрика событий] 2020-10-08 02:19:09
		//		ѕопытка
		//			 лассѕодсистемыƒопѕраваƒоков = —оздатьќбъект("__ лассѕодсистемыƒопѕраваƒоков__");
		//			≈сли  лассѕодсистемыƒопѕраваƒоков.ћожно–едактироватьƒок(“екƒок)=0 “огда // «апрещено
		//				‘лагƒоступности онтролов=0;
		//			 онец≈сли;
		//			 лассѕодсистемыƒопѕраваƒоков = 0;
		//		»сключение
		//		 онецѕопытки;
		///(MA)@TOC, [‘абрика событий] 2020-10-08 02:19:09

	 онец≈сли;
	                                                 
	// 0. ‘ормируем картинку скана на форме
	ф_кн артинка=‘орма–асш.ƒобавитьјтрибут(»д артинки,10); 
	ф_кн артинка.«аголовок = "";
	ф_кн артинка.—лой=»д—ло€;
	Ћево =Ўирина‘/100; ¬ерх =¬ысота‘/100*15; Ўирина =Ўирина‘/100*25; ¬ысота =¬ысота‘/100*25;
	ф_кн артинка.”становить оординаты(Ћево , ¬ерх , Ўирина , ¬ысота );
	 артинка = —оздатьќбъект(" артинка");
	// артинка.«агрузить("E:\1s\Test\Etnolinia\‘ото\Ћого.bmp");	
	ф_кн артинка.«начение.”становить артинку( артинка);         
	ф_кн артинка.«начение.–ежим–исовани€(3);
	ф_кн артинка.—тиль = 1476558859;
	//ф_кн артинка.«аголовок="»зображение";
	//ф_кн артинка.‘ормула=»д√лоб‘ункции+"( онтекст,"""+ф_тз—каны.»дентификатор+""","""+ф_кн артинка.»дентификатор+""")";
	//ф_кн артинка.ѕодсказка="ќткрыть во внешнем приложении, ассоциированном с таким расширением файла";
	
	// 1. ‘ормируем таблицу значений - список сканов
	ф_тз—каны=‘орма–асш.ƒобавитьјтрибут(»д“«—канов,15);
	ф_тз—каны.—лой=»д—ло€;
	//Ћево =Ўирина‘/100*10; ¬ерх =¬ысота‘/100*15; Ўирина =Ўирина‘/100*98; ¬ысота =¬ысота‘/100*80; 
	Ћево =Ћево  + Ўирина  + Ўирина‘/100; Ўирина =Ўирина‘-Ўирина ; ¬ысота =¬ысота‘/100*80;
	ф_тз—каны.”становить оординаты(Ћево , ¬ерх , Ўирина , ¬ысота );	
	ф_тз—каны.‘ормула=»д√лоб‘ункции+"( онтекст,"""+ф_тз—каны.»дентификатор+""","""+ф_тз—каны.»дентификатор+""")";
	ф_тз—каны.ѕодсказка="—писок сканов дока";
	//ф_тз—каны.ƒоступность=‘лагƒоступности онтролов;
	
	// 2. ‘ормируем кнопки

	ф_кнѕросмотр—кана=‘орма–асш.ƒобавитьјтрибут(»д нѕросмотр,3);
	ф_кнѕросмотр—кана.—лой=»д—ло€;
	Ћево =Ўирина‘/100; ¬ерх =¬ысота‘/100; Ўирина =Ўирина‘/100*26; ¬ысота =¬ысота‘/100*13;
	ф_кнѕросмотр—кана.”становить оординаты(Ћево , ¬ерх , Ўирина , ¬ысота );	
	ф_кнѕросмотр—кана.«аголовок="ѕ–ќ—ћќ“–/ѕ≈„ј“№";
	ф_кнѕросмотр—кана.‘ормула=»д√лоб‘ункции+"( онтекст,"""+ф_тз—каны.»дентификатор+""","""+ф_кнѕросмотр—кана.»дентификатор+""")";
	ф_кнѕросмотр—кана.ѕодсказка="ќткрыть во внешнем приложении, ассоциированном с таким расширением файла";

	//ф_кнѕросмотр—кана.ƒоступность=‘лагƒоступности онтролов;

	ф_кнЌовый—кан=‘орма–асш.ƒобавитьјтрибут(»д нЌовый,3);
	ф_кнЌовый—кан.—лой=»д—ло€;
	Ћево =Ћево +Ўирина +Ўирина‘/100; Ўирина =Ўирина‘/100*17;	
	ф_кнЌовый—кан.”становить оординаты(Ћево , ¬ерх , Ўирина , ¬ысота );	
	ф_кнЌовый—кан.«аголовок="Ќќ¬џ…";
	ф_кнЌовый—кан.‘ормула=»д√лоб‘ункции+"( онтекст,"""+ф_тз—каны.»дентификатор+""","""+ф_кнЌовый—кан.»дентификатор+""")";
	ф_кнЌовый—кан.ѕодсказка="ƒобавить новый скан";
	ф_кнЌовый—кан.ƒоступность=‘лагƒоступности онтролов;

	ф_кн–едактировать—кан=‘орма–асш.ƒобавитьјтрибут(»д н–едактировать,3);
	ф_кн–едактировать—кан.—лой=»д—ло€;
	Ћево =Ћево +Ўирина +Ўирина‘/100;	
	ф_кн–едактировать—кан.”становить оординаты(Ћево , ¬ерх , Ўирина , ¬ысота );	
	ф_кн–едактировать—кан.«аголовок="»«ћ≈Ќ»“№";
	ф_кн–едактировать—кан.‘ормула=»д√лоб‘ункции+"( онтекст,"""+ф_тз—каны.»дентификатор+""","""+ф_кн–едактировать—кан.»дентификатор+""")";
	ф_кн–едактировать—кан.ѕодсказка="–едактировать название скана";
	ф_кн–едактировать—кан.ƒоступность=‘лагƒоступности онтролов;
	
	ф_кн”далить—кан=‘орма–асш.ƒобавитьјтрибут(»д н”далить,3);
	ф_кн”далить—кан.—лой=»д—ло€;
	Ћево =Ћево +Ўирина +Ўирина‘/100;	
	ф_кн”далить—кан.”становить оординаты(Ћево , ¬ерх , Ўирина , ¬ысота );	
	ф_кн”далить—кан.«аголовок="”ƒјЋ»“№";
	ф_кн”далить—кан.‘ормула=»д√лоб‘ункции+"( онтекст,"""+ф_тз—каны.»дентификатор+""","""+ф_кн”далить—кан.»дентификатор+""")";
	ф_кн”далить—кан.ѕодсказка="”далить скан";
	ф_кн”далить—кан.ƒоступность=‘лагƒоступности онтролов;

	ф_кнќбновить—каны=‘орма–асш.ƒобавитьјтрибут(»д нќбновить,3);
	ф_кнќбновить—каны.—лой=»д—ло€;
	Ћево =Ћево +Ўирина +Ўирина‘/100;
	ф_кнќбновить—каны.”становить оординаты(Ћево , ¬ерх , Ўирина , ¬ысота );	
	ф_кнќбновить—каны.«аголовок="ќЅЌќ¬»“№";
	ф_кнќбновить—каны.‘ормула=»д√лоб‘ункции+"( онтекст,"""+ф_тз—каны.»дентификатор+""","""+ф_кнќбновить—каны.»дентификатор+""")";
	ф_кнќбновить—каны.ѕодсказка="ќбновить список сканов";
	//ф_кнќбновить—каны.ƒоступность=‘лагƒоступности онтролов;

	ф_текстјвтор=‘орма–асш.ƒобавитьјтрибут(»д“екстјвтор,1);
	ф_текстјвтор.—лой=»д—ло€;
	Ћево =Ўирина‘/100; ¬ысота =¬ысота‘/100*5; ¬ерх =¬ысота‘-¬ысота ; Ўирина =Ўирина‘-Ћево *2;
	ф_текстјвтор.”становить оординаты(Ћево , ¬ерх , Ўирина , ¬ысота );	
	ф_текстјвтор.«начение="(c) Venger Alex, 2010";
	ф_текстјвтор.‘ормула="";
	ф_текстјвтор.ѕодсказка=""; 
	
	ф_текст“екуща€—трока“«=‘орма–асш.ƒобавитьјтрибут(»д“екст“екуща€—трока“«,1);
	ф_текст“екуща€—трока“«.—лой=»д—ло€;
	Ћево =Ћево  + Ўирина  + Ўирина‘/100; ¬ысота =¬ысота‘/100*5; ¬ерх =¬ысота‘-¬ысота ; Ўирина =Ўирина‘-Ћево *2;
	ф_текст“екуща€—трока“«.”становить оординаты(Ћево , ¬ерх , Ўирина , ¬ысота );	
	ф_текст“екуща€—трока“«.«начение="";
	ф_текст“екуща€—трока“«.‘ормула=»д√лоб‘ункции+"( онтекст,"""+ф_тз—каны.»дентификатор+""","""+ф_текст“екуща€—трока“«.»дентификатор+""")";;
	ф_текст“екуща€—трока“«.ѕодсказка="";
	
	 онтќбъекта.‘орма.»спользовать—лой(»д—ло€,0);
	
	‘орма–асш.ѕодсветка«акладки(„исло(«акладки ол¬о( онтќбъекта)), 1);	

	// «аполн€ем значени€ми “«
	ќбновить“«—кановƒоковЌа‘орме( онтќбъекта,ф_тз—каны.»дентификатор);
	
	“ќ _ќтладка.з(фн);
	¬озврат 1;
 онец‘ункции	// —обытие_ѕослеќткрыти€
//-------------------------------------------------------	


//-------------------------------------------------------
‘ункци€ —обытие_ѕослеќткрыти€() Ёкспорт
	фн = "—обытие_ѕослеќткрыти€";
	“ќ _ќтладка.о(фн);
	
	ѕопытка
		¬ыполн€емыйћодуль = —оздатьќбъект("¬ыполн€емыйћодуль");
		¬ыполн€емыйћодуль.”становитьћодуль("
			|л = __ лассѕодсистемы—каныƒоков_”становлен;");
		¬ыполн€емыйћодуль. омпилироватьћодуль();
		¬ыполн€емыйћодуль.¬ыполнитьћодуль();
	»сключение
		ƒобавитьƒоп√лобћодуль();
	 онецѕопытки;	
	
	–ез=1;
	 онт‘ормы =  онтекст‘ормы;
	“ќ _ќтладка.—оо(" онт‘ормы :: "+ онт‘ормы);
	
	‘орма–асш = —оздатьќбъект("–асширение‘ормы"); 
	‘орма–асш.”становить‘орму( онт‘ормы.‘орма);
	“ќ _ќтладка.—оо("‘орма–асш :: "+‘орма–асш.ѕолный“ипќбъекта());
	
	—ообщить(‘орма–асш.ѕолный“ипќбъекта());
	≈сли (Ќайти(‘орма–асш.ѕолный“ипќбъекта(),"—каныƒоков")>0) “огда
		“ќ _ќтладка.з(фн + " :::: 1");
		¬озврат –ез;	
	 онец≈сли;	
	
	≈сли (Ќайти(‘орма–асш.ѕолный“ипќбъекта(),"—правочник.")>0)
		и (Ќайти(‘орма–асш.ѕолный“ипќбъекта(),"‘орма—писка")>0) “огда
		“ќ _ќтладка.з(фн + " :::: 2");
		¬озврат –ез;	
	 онец≈сли;	
	
	–ез=ѕослеќткрыти€_—озданиеЁлементов‘ормы();
	
	“ќ _ќтладка.з(фн);
	¬озврат –ез;
 онец‘ункции  // ‘—_—обытие_ѕослеќткрыти€
//-------------------------------------------------------


//-------------------------------------------------------	
‘ункци€ –езультат_ѕри»зменении–азмераќкна(“ип—обыти€,Ўирина,¬ысота) Ёкспорт
	–ез=1;
	≈сли “ип—обыти€=1 “огда
		¬озврат –ез;
	 онец≈сли;
	≈сли (Ўирина<=0) »Ћ» (¬ысота<=0) “огда
		¬озврат –ез;		
	 онец≈сли;
	//Ўирина‘=Ўирина;	¬ысота‘=¬ысота;
	
	 онтќбъекта = GetThis( онтекст).ѕолучить онтекстќкружени€();
	≈сли “ип«начени€—тр( онтќбъекта) <> "√рупповой онтекст" “огда
		≈сли “ип«начени€—тр( онт‘ормы) = "√рупповой онтекст" “огда
			 онтќбъекта=  онт‘ормы;		
		»наче
			¬озврат –ез;
		 онец≈сли;
	 онец≈сли;
	‘орма–асш = —оздатьќбъект("–асширение‘ормы"); 
	‘орма–асш.”становить‘орму( онтќбъекта.‘орма);
	Ўирина‘=‘орма–асш.Ўирина;	
	¬ысота‘=‘орма–асш.¬ысота;
	
	//+(MA)@TOC 2020.11.24 [ƒобавление картинки на форму]
	// ƒл€  артинки	
	Ћево =Ўирина‘/100; ¬ерх =¬ысота‘/100*15; Ўирина =Ўирина‘/100*25; ¬ысота =Ўирина ;
	ѕопытка                                                                                 
		ф_ онтрол=‘орма–асш.ѕолучитьјтрибут(»д артинки);
		 артинка = ф_ онтрол.«начение;
		//ѕуста€ артинка = —оздатьќбъект(" артинка");
		ф_ онтрол.”становить оординаты(Ћево , ¬ерх , Ўирина , ¬ысота );	
		//ф_ онтрол.«начение.”становить артинку(ѕуста€ артинка);
		//ф_ онтрол.«начение.”становить артинку( артинка);
		 онтќбъекта.‘орма.ќбновить();
	»сключение
		¬озврат –ез;
	 онецѕопытки;
	
	// ƒл€ “«	
	//Ћево =Ўирина‘/100; ¬ерх =¬ысота‘/100*15; Ўирина =Ўирина‘/100*98; ¬ысота =¬ысота‘/100*80; 
	Ћево =Ћево  + Ўирина  + Ўирина‘/100; ¬ерх =¬ысота‘/100*15; Ўирина =Ўирина‘/100*70; ¬ысота =¬ысота‘/100*80;
	ѕопытка
		ф_ онтрол=‘орма–асш.ѕолучитьјтрибут(»д“«—канов);		
		ф_ онтрол.”становить оординаты(Ћево , ¬ерх , Ўирина , ¬ысота );	
	»сключение
		¬озврат –ез;
	 онецѕопытки;


	
	// ƒл€ кнопок
	Ћево =Ўирина‘/100; ¬ерх =¬ысота‘/100; Ўирина =Ўирина‘/100*26; ¬ысота =¬ысота‘/100*13;
	ѕопытка
		ф_ онтрол=‘орма–асш.ѕолучитьјтрибут(»д нѕросмотр);	
		ф_ онтрол.”становить оординаты(Ћево , ¬ерх , Ўирина , ¬ысота );	
	»сключение
		¬озврат –ез;
	 онецѕопытки;
	
	Ћево =Ћево +Ўирина +Ўирина‘/100; Ўирина =Ўирина‘/100*17;
	ѕопытка
		ф_ онтрол=‘орма–асш.ѕолучитьјтрибут(»д нЌовый);	
		ф_ онтрол.”становить оординаты(Ћево , ¬ерх , Ўирина , ¬ысота );	
	»сключение
		¬озврат –ез;
	 онецѕопытки;

	Ћево =Ћево +Ўирина +Ўирина‘/100;
	ѕопытка
		ф_ онтрол=‘орма–асш.ѕолучитьјтрибут(»д н–едактировать);	
		ф_ онтрол.”становить оординаты(Ћево , ¬ерх , Ўирина , ¬ысота );	
	»сключение
		¬озврат –ез;
	 онецѕопытки;

	Ћево =Ћево +Ўирина +Ўирина‘/100;
	ѕопытка
		ф_ онтрол=‘орма–асш.ѕолучитьјтрибут(»д н”далить);	
		ф_ онтрол.”становить оординаты(Ћево , ¬ерх , Ўирина , ¬ысота );	
	»сключение
		¬озврат –ез;
	 онецѕопытки;

	Ћево =Ћево +Ўирина +Ўирина‘/100;
	ѕопытка
		ф_ онтрол=‘орма–асш.ѕолучитьјтрибут(»д нќбновить);	
		ф_ онтрол.”становить оординаты(Ћево , ¬ерх , Ўирина , ¬ысота );	
	»сключение
		¬озврат –ез;
	 онецѕопытки;
	
	Ћево =Ўирина‘/100; ¬ысота =¬ысота‘/100*5; ¬ерх =¬ысота‘-¬ысота ; Ўирина =Ўирина‘-Ћево *2;
	ѕопытка
		ф_ онтрол=‘орма–асш.ѕолучитьјтрибут(»д“екстјвтор);	
		ф_ онтрол.”становить оординаты(Ћево , ¬ерх , Ўирина , ¬ысота );	
	»сключение
		¬озврат –ез;
	 онецѕопытки;
	
	¬озврат –ез;
 онец‘ункции	// —обытие_ѕри»зменении–азмераќкна
//-------------------------------------------------------	


//-------------------------------------------------------	
‘ункци€ —обытие_ѕри»зменении–азмераќкна(“ип—обыти€,Ўирина,¬ысота) Ёкспорт // @# (≈сть изменени€) (MA)@TOC  
	–ез=1;
	‘орма–асш = —оздатьќбъект("–асширение‘ормы"); 
	‘орма–асш.”становить‘орму( онт‘ормы.‘орма);
	
	–ез=–езультат_ѕри»зменении–азмераќкна(“ип—обыти€,Ўирина,¬ысота);
	¬озврат –ез;	
 онец‘ункции // ‘—_—обытие_ѕри»зменении–азмераќкна
//-------------------------------------------------------


//-------------------------------------------------------
‘ункци€ –езультат_ѕри¬ыборе«акладки(Ќом,«н) Ёкспорт
	–ез=1;
	 онтќбъекта = GetThis( онтекст).ѕолучить онтекстќкружени€();
	≈сли “ип«начени€—тр( онтќбъекта) <> "√рупповой онтекст" “огда
		≈сли “ип«начени€—тр( онт‘ормы) = "√рупповой онтекст" “огда
			 онтќбъекта=  онт‘ормы;		
		»наче
			¬озврат –ез;
		 онец≈сли;
	 онец≈сли;
	
		//*(MA)@TOC, [‘абрика событий] 2020-10-08 01:22:16
		//	ѕопытка
		//		“екƒок =  онтќбъекта.“екущийƒокумент();
		//		≈сли “ип«начени€(“екƒок)<>12 “огда // “ип =12 - ƒокумент
		//			¬озврат –ез;
		//		 онец≈сли;
		//	»сключение
		//		¬озврат –ез;
		//	 онецѕопытки;
		// -------- заменено на:
		“екќбъект = ѕолучить—сылку( онтќбъекта);
		≈сли “екќбъект = "" “огда
			¬озврат –ез;
		 онец≈сли;			
		///(MA)@TOC, [‘абрика событий] 2020-10-08 01:22:16
	
	ѕоз¬кладки—канов= онтќбъекта.‘орма.«акладки.Ќайти«начение(»д¬кладки);
	≈сли ѕоз¬кладки—канов>0 “огда
		≈сли ≈стьѕодчиненныеƒоки—канов”ќбъекта(“екќбъект)>0 “огда			
			 онтќбъекта.‘орма.«акладки.”становить«начение(ѕоз¬кладки—канов,»д¬кладки,"(!) "+»м€¬кладки);
		»наче				
			 онтќбъекта.‘орма.«акладки.”становить«начение(ѕоз¬кладки—канов,»д¬кладки,»м€¬кладки);
		 онец≈сли;
	 онец≈сли;
		
	 онтќбъекта.‘орма.»спользовать—лой(«н,2);
	
	≈сли «н=»д¬кладки “огда
		–ез=0;
	 онец≈сли;
	
	¬озврат –ез;
 онец‘ункции  // —обытие_ѕри¬ыборе«акладки
//-------------------------------------------------------

//-------------------------------------------------------
‘ункци€ —обытие_ѕри¬ыборе«акладки(Ќомер«акладки, «начение«акладки) Ёкспорт
	–ез=1;
	
	—ообщить(»д ласса+"::‘—_—обытие_ѕри¬ыборе«акладки:: онт‘ормы = "+ онт‘ормы);
	
	‘орма–асш = —оздатьќбъект("–асширение‘ормы"); 
	‘орма–асш.”становить‘орму( онт‘ормы.‘орма);
	≈сли (Ќайти(‘орма–асш.ѕолный“ипќбъекта(),"—каныƒоков")>0) “огда
		¬озврат –ез;	
	 онец≈сли;		
	
	–ез=–езультат_ѕри¬ыборе«акладки(Ќомер«акладки,«начение«акладки);
	
	¬озврат –ез;
 онец‘ункции	// ‘—_—обытие_ѕри¬ыборе«акладки
//-------------------------------------------------------


//-------------------------------------------------------
‘ункци€ —обытие√ћ_ѕри”даленииƒокумента(ƒок,–ежим) Ёкспорт
	–ез=1;
	¬идƒока=—окрЋѕ(ƒок.¬ид());
	ѕометка=?(„исло(ƒок.ѕометка”далени€())=0,1,0);
	
	// ѕометка на удаление доков
	≈сли –ежим=0 “огда
		≈сли ¬идƒока=»д¬идаƒоковƒл€—канов “огда
			ѕредупреждение("Ёто служебный документ, интерактивна€ пометка на удаление дл€ него не актуальна",5);
			//—ообщить("Ёто служебный документ, интерактивна€ пометка на удаление дл€ него не актуальна","i");
			–ез=0;
			¬озврат –ез;
		»наче
			// ѕомечаем и все подчиненные
			“екƒок=ƒок;
			≈сли (“ип«начени€(“екƒок)<>12) “огда // “ип =12 - ƒокумент
				–ез=0;
				¬озврат –ез;
			 онец≈сли;
			≈сли “екƒок.¬ыбран()=0 “огда
				–ез=0;
				¬озврат –ез;
			 онец≈сли; 
		
			—каныƒоков=—оздатьќбъект("ƒокумент");
			—каныƒоков.¬ыбратьѕодчиненныеƒокументы(,,“екƒок);
			ѕока —каныƒоков.ѕолучитьƒокумент() = 1 ÷икл
				≈сли —каныƒоков.¬ыбран()<=0 “огда
					ѕродолжить;
				 онец≈сли;
				≈сли —каныƒоков.¬ид()<>»д¬идаƒоковƒл€—канов “огда
					ѕродолжить;
				 онец≈сли;
				
				≈сли ѕометка=0 “огда
					—каныƒоков.—н€тьѕометку”далени€();
				»наче
					—каныƒоков.”далить(0);	
				 онец≈сли;	
			 онец÷икла;
		 онец≈сли;
	»наче	// Ќепосредственное удаление
	 онец≈сли;	

	¬озврат –ез;	
 онец‘ункции  // —обытие√ћ_ѕри”даленииƒокумента
//-------------------------------------------------------

//-------------------------------------------------------
‘ункци€ ‘—_—обытие√ћ_ѕри”даленииƒокумента(»здатель, спѕарам) Ёкспорт
	–ез=1;
	≈сли “ип«начени€—тр(спѕарам)<>"—писок«начений" “огда
		¬озврат –ез;	
	 онец≈сли;
	ƒок=спѕарам.ѕолучить("ƒок");
	–ежим=спѕарам.ѕолучить("–ежим");

	–ез=—обытие√ћ_ѕри”даленииƒокумента(ƒок,–ежим);
	
	¬озврат –ез;
 онец‘ункции  // ‘—_—обытие√ћ_ѕри”даленииƒокумента
//-------------------------------------------------------

/////////////////////////////////////////////////////////
//******** ‘ормулы контролов на доп. вкладке **********//
/////////////////////////////////////////////////////////

//-------------------------------------------------------
‘ункци€ ќбновить“«—кановƒоковЌа‘орме( онт,»дјтр) Ёкспорт
	‘орма–асш = —оздатьќбъект("–асширение‘ормы"); 
	‘орма–асш.”становить‘орму( онт.‘орма);
	“з—канов=‘орма–асш.ѕолучитьјтрибут(»дјтр);
	“з—канов=“з—канов.«начение;
	
	“з—канов.ќчистить();
	“з—канов.Ќова€ олонка("Ќом",,,,"є",5);
	“з—канов.Ќова€ олонка("»м€",,,,"»м€",30);
	“з—канов.Ќова€ олонка("≈сть",,,,"+/-",5);	
	“з—канов.Ќова€ олонка("ѕуть");
	“з—канов.Ќова€ олонка("ƒок");
	“з—канов.Ќова€ олонка("Ќом—трƒок");
	“з—канов.¬идимость олонки("ѕуть",0);
	“з—канов.¬идимость олонки("ƒок",0);
	“з—канов.¬идимость олонки("Ќом—трƒок",0);
	

	//*(MA)@TOC, [feature/1] 2020-11-26 14:17:03
	//	ѕопытка
	//		“екƒок =  онт.“екущийƒокумент();
	//		≈сли (“ип«начени€(“екƒок)<>12) »Ћ» (“екƒок.¬ыбран()=0) “огда // “ип =12 - ƒокумент
	//			¬озврат "";
	//		 онец≈сли;
	//	»сключение
	//		¬озврат "";
	//	 онецѕопытки;
	// -------- заменено на:
	“екќбъект = ѕолучить—сылку( онт);
	≈сли “екќбъект = "" “огда
		¬озврат "";
	 онец≈сли;
	///(MA)@TOC, [feature/1] 2020-11-26 14:17:03

	
	// ¬ыбрать все подчиненные документу не помеченные на удаление
	// документы вида "—каныƒоков" и записать их в “« на форме

	//*(MA)@TOC, [feature/1] 2020-11-26 13:03:57
	//	—каныƒоков=—оздатьќбъект("ƒокумент");
	//	—каныƒоков.¬ыбратьѕодчиненныеƒокументы(,,“екƒок);
	//	ѕока —каныƒоков.ѕолучитьƒокумент() = 1 ÷икл
	//		—ч=1+—ч;
	//		—осто€ние("ќбработка сканов дока: "+—ч);
	//		
	//		≈сли —каныƒоков.¬ыбран()<=0 “огда
	//			ѕродолжить;
	//		 онец≈сли;
	//		
	//		
	//		≈сли —каныƒоков.¬ид()<>»д¬идаƒоковƒл€—канов “огда
	//			ѕродолжить;
	//		 онец≈сли;
	//		≈сли —каныƒоков.ѕометка”далени€()>0 “огда
	//			ѕродолжить;
	//		 онец≈сли;
	//		
	//		—каныƒоков.¬ыбрать—троки();
	//		ѕока —каныƒоков.ѕолучить—троку() = 1 ÷икл
	//			—ч=1+—ч;
	//			—осто€ние("ќбработка сканов дока: "+—ч);
	//			“з—канов.Ќова€—трока();
	//			“з—канов.Ќом = ѕеревод»зƒес€тичной¬–имскую—истему—числени€(—каныƒоков.Ќомер—троки);
	//			“з—канов.»м€ = —каныƒоков.»м€;
	//			“з—канов.≈сть = ?((‘—.—уществует‘айл(»м€ѕапкиƒл€—канов+"\"+—каныƒоков.ѕуть)>0) » (ѕуста€—трока(—окрЋѕ(—каныƒоков.ѕуть))=0),"+","-");
	//			“з—канов.ѕуть = —окрЋѕ(—каныƒоков.ѕуть);	
	//			“з—канов.ƒок = —каныƒоков.“екущийƒокумент();
	//			“з—канов.Ќом—трƒок = —каныƒоков.Ќомер—троки;
	//		 онец÷икла;
	//	 онец÷икла;
	// -------- заменено на:
		—каныƒоков=—оздатьќбъект("ƒокумент."+»д¬идаƒоковƒл€—канов);
		≈сли ≈стьѕодчиненныеƒоки—канов”ќбъекта(“екќбъект) = 1 “огда
			—каныƒоков.Ќайтиƒокумент(ѕолучитьѕодчиненныйƒок—кановќбъекта(“екќбъект).“екущийƒокумент());
		»наче
			¬озврат "";
		 онец≈сли;	
		
		—каныƒоков.¬ыбрать—троки();
		ѕока —каныƒоков.ѕолучить—троку() = 1 ÷икл
			—ч=1+—ч;
			—осто€ние("ќбработка сканов дока: "+—ч);
			“з—канов.Ќова€—трока();
			“з—канов.Ќом = ѕеревод»зƒес€тичной¬–имскую—истему—числени€(—каныƒоков.Ќомер—троки);
			“з—канов.»м€ = —каныƒоков.»м€;
			“з—канов.≈сть = ?((‘—.—уществует‘айл(»м€ѕапкиƒл€—канов+"\"+—каныƒоков.ѕуть)>0) » (ѕуста€—трока(—окрЋѕ(—каныƒоков.ѕуть))=0),"+","-");
			“з—канов.ѕуть = —окрЋѕ(—каныƒоков.ѕуть);	
			“з—канов.ƒок = —каныƒоков.“екущийƒокумент();
			“з—канов.Ќом—трƒок = —каныƒоков.Ќомер—троки;
		 онец÷икла;
	///(MA)@TOC, [feature/1] 2020-11-26 13:03:57

	—осто€ние("");
	¬озврат "";
 онец‘ункции	// ќбновить“«—кановƒоковЌа‘орме
//-------------------------------------------------------

//-------------------------------------------------------
‘ункци€ Ќовый—кан¬“«—кановƒоковЌа‘орме( онт,»дјтр) Ёкспорт
	‘орма–асш = —оздатьќбъект("–асширение‘ормы"); 
	‘орма–асш.”становить‘орму( онт.‘орма);
	“з—канов=‘орма–асш.ѕолучитьјтрибут(»дјтр);
	“з—канов=“з—канов.«начение;
	
	ѕопытка

		//*(MA)@TOC, [‘абрика событий] 2020-10-08 01:19:12
		//		“екќбъект =  онт.“екущийƒокумент();
		//		≈сли (“ип«начени€(“екƒок)<>12) “огда // “ип =12 - ƒокумент
		//			¬озврат "";
		//		 онец≈сли;
		// -------- заменено на:
		“екќбъект = ѕолучить—сылку( онт);
		≈сли “екќбъект = "" “огда
		 онец≈сли;
		///(MA)@TOC, [‘абрика событий] 2020-10-08 01:19:12

	»сключение
		¬озврат "";
	 онецѕопытки;
	
	≈сли “екќбъект.¬ыбран()=0 “огда
		ѕредупреждение("ѕрежде запишите или проведите текущий документ",5);
		//—ообщить("ѕрежде запишите или проведите текущий документ","i");	
		¬озврат "";
	 онец≈сли; 

	// —прашиваем файл и строку у пользовател€,
	»м€‘айла="";
	ѕуть‘айла="";
	≈сли ‘—.—уществует‘айл(»м€ѕапкиƒл€—канов)<=0 “огда
		‘—.—оздать аталог(»м€ѕапкиƒл€—канов);
	 онец≈сли;
	¬ыб»м€‘айла=""; ¬ыб аталог‘айла= аталог¬ременных‘айлов();
	//≈сли ‘—.¬ыбрать‘айл артинки(0,¬ыб»м€‘айла,¬ыб аталог‘айла,"¬ыберите файл скана")<=0 “огда
	≈сли ‘—.¬ыбрать‘айл(0,¬ыб»м€‘айла,¬ыб аталог‘айла,"¬ыберите файл скана")<=0 “огда
		¬озврат "";
	 онец≈сли;
	¬ыб аталог‘айла=—окрЋѕ(¬ыб аталог‘айла);
	¬ыб»м€‘айла=—окрЋѕ(¬ыб»м€‘айла);
	ѕуть‘айла=¬ыб аталог‘айла+¬ыб»м€‘айла;
	–асширение‘айла=¬ыб»м€‘айла;
	ƒл€ —ч=1 ѕо —тр„исло¬хождений(¬ыб»м€‘айла,".") ÷икл
		»нд“чк=Ќайти(–асширение‘айла,".");
		≈сли »нд“чк<=0 “огда
			ѕрервать;
		 онец≈сли;
		–асширение‘айла=ѕрав(–асширение‘айла,—трƒлина(–асширение‘айла)-»нд“чк);
	 онец÷икла;
	—вобћестоЌаƒискеЅазы=„исло(‘—.—вободноећестоЌаƒиске(»м€ѕапкиƒл€—канов));
	—вобћестоЌаƒискеЅазы=?(—вобћестоЌаƒискеЅазы<(-1),-1*—вобћестоЌаƒискеЅазы,—вобћестоЌаƒискеЅазы);
	FileSize=0; ‘—.јтрибуты‘айла(ѕуть‘айла, FileSize); 
	FileSize=„исло(?(„исло(FileSize)<(-1),-1*„исло(FileSize),FileSize));
	≈сли —вобћестоЌаƒискеЅазы < FileSize “огда
		ѕредупреждение("Ќет места на диске с базой дл€ добавлени€ нового файла-скана",5);
		//—ообщить("Ќет места на диске с базой дл€ добавлени€ нового файла-скана","i");
		¬озврат "";
	 онец≈сли;
	
	¬ыб—трока»мени=¬ыб»м€‘айла;
	¬вести—троку(¬ыб—трока»мени,"¬ведите инф. им€ дл€ скана",50,0);
	»м€‘айла=—окрЋѕ(¬ыб—трока»мени);
	
	—ервис=—оздатьќбъект("—ервис");
	Ќов»м€‘айла=—ервис.ѕолучитьGUID();
	Ќов»м€‘айла=—тр«аменить(Ќов»м€‘айла,"-","_");
	Ќов»м€‘айла=—тр«аменить(Ќов»м€‘айла,"{","");
	Ќов»м€‘айла=—тр«аменить(Ќов»м€‘айла,"}","");
	≈сли ѕуста€—трока(–асширение‘айла)<=0 “огда
		Ќов»м€‘айла=Ќов»м€‘айла+"."+–асширение‘айла;	
	 онец≈сли;
	
	ѕока ‘—.—уществует‘айл(»м€ѕапкиƒл€—канов+"\"+Ќов»м€‘айла)>0 ÷икл
		Ќов»м€‘айла=—ервис.ѕолучитьGUID();
		Ќов»м€‘айла=—тр«аменить(Ќов»м€‘айла,"-","_");
		Ќов»м€‘айла=—тр«аменить(Ќов»м€‘айла,"{","");
		Ќов»м€‘айла=—тр«аменить(Ќов»м€‘айла,"}","");
		≈сли ѕуста€—трока(–асширение‘айла)<=0 “огда
			Ќов»м€‘айла=Ќов»м€‘айла+"."+–асширение‘айла;	
		 онец≈сли;
	 онец÷икла;
	
	‘—. опировать‘айл(ѕуть‘айла,»м€ѕапкиƒл€—канов+"\"+Ќов»м€‘айла,0);
	ѕуть‘айла=Ќов»м€‘айла;

	// ”знать, есть ли подчиненные доки-сканы у этого дока,
	// если нет, создать новый док-скан. ≈сли есть, вз€ть первый.
	// » в этот док и добавить строку, записать док, использу€
	// вз€тые у пользовател€ значени€ пути к файлу и имени.
	≈сли ≈стьѕодчиненныеƒоки—канов”ќбъекта(“екќбъект)=0 “огда
		Ќовƒок—кан=—оздатьќбъект("ƒокумент."+»д¬идаƒоковƒл€—канов);
		Ќовƒок—кан.Ќовый();
		//Ќовƒок—кан.Ќомерƒок = ;
		// ƒл€ нумерации в распределенных »Ѕ
		Ќовƒок—кан.”становитьЌовыйЌомер(—окрЋѕ(“екуща€»Ѕ од()));
		Ќовƒок—кан.ƒатаƒок = –абоча€ƒата();

		//*(MA)@TOC, [‘абрика событий] 2020-10-08 01:47:10
		//		Ќовƒок—кан.ƒок = “екƒок;
		≈сли Ётоƒокумент(“екќбъект) = 1 “огда
			Ќовƒок—кан.ƒок = “екќбъект;
		»наче≈сли Ёто—правочник(“екќбъект) = 1 “огда
			Ќовƒок—кан.—пр = “екќбъект;
		 онец≈сли;
		
		///(MA)@TOC, [‘абрика событий] 2020-10-08 01:47:10

		Ќовƒок—кан.«аписать();
	»наче

		//*(MA)@TOC, [‘абрика событий] 2020-10-08 01:43:30
		//		—каныƒоков=—оздатьќбъект("ƒокумент");
		//		—каныƒоков.¬ыбратьѕодчиненныеƒокументы(,,“екƒок);
		//		ѕока —каныƒоков.ѕолучитьƒокумент() = 1 ÷икл
		//			≈сли —каныƒоков.¬ыбран()<=0 “огда
		//				ѕродолжить;
		//			 онец≈сли;
		//			≈сли —каныƒоков.¬ид()<>»д¬идаƒоковƒл€—канов “огда
		//				ѕродолжить;
		//			 онец≈сли;
		//			≈сли —каныƒоков.ѕометка”далени€()>0 “огда
		//				ѕродолжить;
		//			 онец≈сли;
		//			
		//			Ќовƒок—кан=—оздатьќбъект("ƒокумент."+»д¬идаƒоковƒл€—канов);
		//			Ќовƒок—кан.Ќайтиƒокумент(—каныƒоков.“екущийƒокумент());
		//			
		//			ѕрервать;
		//		 онец÷икла;
		// -------- заменено на:
		
			Ќовƒок—кан=—оздатьќбъект("ƒокумент."+»д¬идаƒоковƒл€—канов);
			Ќовƒок—кан.Ќайтиƒокумент(ѕолучитьѕодчиненныйƒок—кановќбъекта(“екќбъект).“екущийƒокумент());
	
		///(MA)@TOC, [‘абрика событий] 2020-10-08 01:43:30

	 онец≈сли;
	
	Ќовƒок—кан.Ќова€—трока();
	Ќовƒок—кан.»м€ = »м€‘айла;
	Ќовƒок—кан.ѕуть = ѕуть‘айла;
	Ќовƒок—кан.«аписать(); 
	
	//«аполн€ем “«
	“з—канов.Ќова€—трока();
	“з—канов.Ќом = ѕеревод»зƒес€тичной¬–имскую—истему—числени€(“з—канов. оличество—трок());
	“з—канов.»м€ = »м€‘айла;
	“з—канов.≈сть = ?((‘—.—уществует‘айл(»м€ѕапкиƒл€—канов+"\"+ѕуть‘айла)>0) » (ѕуста€—трока(—окрЋѕ(ѕуть‘айла))=0),"+","-");
	“з—канов.ѕуть = —окрЋѕ(ѕуть‘айла);	
	“з—канов.ƒок = Ќовƒок—кан;
	“з—канов.Ќом—трƒок = Ќовƒок—кан. оличество—трок();
	
	¬озврат "";
 онец‘ункции	// Ќовый—кан¬“«—кановƒоковЌа‘орме
//-------------------------------------------------------

//-------------------------------------------------------
‘ункци€ ”далить—кан»з“«—кановƒоковЌа‘орме( онт,»дјтр) Ёкспорт //@# (≈сть изменени€) (MA)@TOC  
	‘орма–асш = —оздатьќбъект("–асширение‘ормы"); 
	‘орма–асш.”становить‘орму( онт.‘орма);
	“з—канов=‘орма–асш.ѕолучитьјтрибут(»дјтр);
	“з—канов=“з—канов.«начение;
	

	//*(MA)@TOC, [feature/1] 2020-11-26 14:23:19
	//	ѕопытка
	//		“екƒок =  онт.“екущийƒокумент();
	//		≈сли (“ип«начени€(“екƒок)<>12) “огда // “ип =12 - ƒокумент
	//			¬озврат "";
	//		 онец≈сли;
	//	»сключение
	//		¬озврат "";
	//	 онецѕопытки;
	// -------- заменено на:
	“екќбъект = ѕолучить—сылку( онт);
	≈сли “екќбъект = "" “огда	
		¬озврат "";
	 онец≈сли;
	///(MA)@TOC, [feature/1] 2020-11-26 14:23:19

	

	//*(MA)@TOC, [feature/1] 2020-11-26 14:01:21
	//	≈сли “екƒок.¬ыбран()=0 “огда
	//		ѕредупреждение("ѕрежде запишите или проведите текущий документ",5);
	// -------- заменено на:
	≈сли “екќбъект.¬ыбран()=0 “огда
		ѕредупреждение("ѕрежде запишите или проведите текущий объект",5);
	///(MA)@TOC, [feature/1] 2020-11-26 14:01:21

		//—ообщить("ѕрежде запишите или проведите текущий документ","i");	
		¬озврат "";
	 онец≈сли; 
	

	//*(MA)@TOC, [feature/1] 2020-11-26 14:17:22
	//	≈сли ≈стьѕодчиненныеƒоки—канов”ƒока(“екƒок)=0 “огда
	//		// Ќечего
	// -------- заменено на:
	≈сли ≈стьѕодчиненныеƒоки—канов”ќбъекта(“екќбъект)=0 “огда
	///(MA)@TOC, [feature/1] 2020-11-26 14:17:22

		// Ќечего
		ѕредупреждение("Ќечего удал€ть",5);
		//—ообщить("Ќечего удал€ть","i");	
		¬озврат "";
	 онец≈сли;
	≈сли “з—канов. оличество—трок()<=0 “огда
		// Ќечего
		ѕредупреждение("Ќечего удал€ть",5);
		//—ообщить("Ќечего удал€ть","i");	
		¬озврат "";
	 онец≈сли;
	
	“ек—тр=“з—канов.“екуща€—трока();
	“ек ол=“з—канов.“екуща€ олонка();
	
	≈сли (“ек—тр<=0) »Ћ» (“ек—тр>“з—канов. оличество—трок()) “огда
		// Ќечего
		¬озврат "";
	 онец≈сли;
	
	ƒок—кан=—оздатьќбъект("ƒокумент."+»д¬идаƒоковƒл€—канов);
	≈сли ƒок—кан.Ќайтиƒокумент(“з—канов.ѕолучить«начение(“ек—тр,"ƒок"))<=0 “огда
		// Ќечего
		¬озврат "";
	 онец≈сли;
	≈сли ƒок—кан.¬ыбран()<=0 “огда
		// Ќечего
		¬озврат "";
	 онец≈сли;
	
	≈сли ƒок—кан.ѕолучить—трокуѕоЌомеру(“з—канов.ѕолучить«начение(“ек—тр,"Ќом—трƒок"))<=0 “огда
		// Ќечего
		¬озврат "";
	 онец≈сли;
	
	// ‘айл надо удалить или спросить сначала,
	// а потом удалить, если он там есть
	ѕуть‘айла=—окрЋѕ(»м€ѕапкиƒл€—канов+"\"+ƒок—кан.ѕуть);
	≈сли (‘—.—уществует‘айл(ѕуть‘айла)>0) » (ѕуста€—трока(—окрЋѕ(ƒок—кан.ѕуть))=0)  “огда
		‘—.”далить‘айл(ѕуть‘айла);
	 онец≈сли;
	
	ƒок—кан.”далить—троку();
	ƒок—кан.«аписать();
	
	≈сли ƒок—кан. оличество—трок()<=0 “огда
		ƒок—кан.”далить(1);
	 онец≈сли;
	
	ќбновить“«—кановƒоковЌа‘орме( онт,»дјтр);
	
	¬озврат "";
 онец‘ункции	// ”далить—кан»з“«—кановƒоковЌа‘орме
//-------------------------------------------------------

//-------------------------------------------------------
‘ункци€ –едактировать—кан»з“«—кановƒоковЌа‘орме( онт,»дјтр) Ёкспорт //@# (≈сть изменени€) (MA)@TOC  
	‘орма–асш = —оздатьќбъект("–асширение‘ормы"); 
	‘орма–асш.”становить‘орму( онт.‘орма);
	“з—канов=‘орма–асш.ѕолучитьјтрибут(»дјтр);
	“з—канов=“з—канов.«начение;
	

	//*(MA)@TOC, [bug/1] 2020-11-26 14:41:58
	//	ѕопытка
	//		“екƒок =  онт.“екущийƒокумент();
	//		≈сли (“ип«начени€(“екƒок)<>12) “огда // “ип =12 - ƒокумент
	//			¬озврат "";
	//		 онец≈сли;
	//	»сключение
	//		¬озврат "";
	//	 онецѕопытки;
	// -------- заменено на:
	“екќбъект = ѕолучить—сылку( онт);
	≈сли “екќбъект = "" “огда
		¬озврат "";
	 онец≈сли;
	///(MA)@TOC, [bug/1] 2020-11-26 14:41:58

	

	//*(MA)@TOC, [bug/1] 2020-11-26 14:07:59
	//	≈сли “екƒок.¬ыбран()=0 “огда
	//		ѕредупреждение("ѕрежде запишите или проведите текущий документ",5);
	// -------- заменено на:
	≈сли “екќбъект.¬ыбран()=0 “огда
		ѕредупреждение("ѕрежде запишите или проведите текущий объект",5);
	///(MA)@TOC, [bug/1] 2020-11-26 14:07:59

		//—ообщить("ѕрежде запишите или проведите текущий документ","i");	
		¬озврат "";
	 онец≈сли; 
	

	//*(MA)@TOC, [bug/1] 2020-11-26 14:40:59
	//	≈сли ≈стьѕодчиненныеƒоки—канов”ƒока(“екƒок)=0 “огда
	≈сли ≈стьѕодчиненныеƒоки—канов”ќбъекта(“екќбъект)=0 “огда
	///(MA)@TOC, [bug/1] 2020-11-26 14:40:59

		// Ќечего
		ѕредупреждение("Ќечего редактировать",5);
		//—ообщить("Ќечего редактировать","i");	
		¬озврат "";
	 онец≈сли;
	≈сли “з—канов. оличество—трок()<=0 “огда
		// Ќечего
		ѕредупреждение("Ќечего редактировать",5);
		//—ообщить("Ќечего редактировать","i");	
		¬озврат "";
	 онец≈сли;
	
	“ек—тр=“з—канов.“екуща€—трока();
	“ек ол=“з—канов.“екуща€ олонка();
	
	≈сли (“ек—тр<=0) »Ћ» (“ек—тр>“з—канов. оличество—трок()) “огда
		// Ќечего
		¬озврат "";
	 онец≈сли;
	
	ƒок—кан=—оздатьќбъект("ƒокумент."+»д¬идаƒоковƒл€—канов);
	≈сли ƒок—кан.Ќайтиƒокумент(“з—канов.ѕолучить«начение(“ек—тр,"ƒок"))<=0 “огда
		// Ќечего
		¬озврат "";
	 онец≈сли;
	≈сли ƒок—кан.¬ыбран()<=0 “огда
		// Ќечего
		¬озврат "";
	 онец≈сли;
	
	≈сли ƒок—кан.ѕолучить—трокуѕоЌомеру(“з—канов.ѕолучить«начение(“ек—тр,"Ќом—трƒок"))<=0 “огда
		// Ќечего
		¬озврат "";
	 онец≈сли;
	
	// TODO: 
	// –абота с файлами?
	
	//≈сли “ек ол="»м€" “огда
        ¬ыб«н=“з—канов.ѕолучить«начение(“ек—тр,"»м€");
		≈сли ¬вести—троку(¬ыб«н,"¬ведите им€ скана",50)=1 “огда
			ƒок—кан.»м€=—окрЋѕ(¬ыб«н);
			ƒок—кан.«аписать();	
			ќбновить“«—кановƒоковЌа‘орме( онт,»дјтр);	
		 онец≈сли;
	//»наче
	//	¬озврат "";		
	// онец≈сли;
	
	¬озврат "";
 онец‘ункции	// –едактировать—кан»з“«—кановƒоковЌа‘орме
//-------------------------------------------------------

//-------------------------------------------------------
‘ункци€ ѕросмотр—кана»з“«—кановƒоковЌа‘орме( онт,»дјтр) Ёкспорт //@# (≈сть изменени€) (MA)@TOC  
	‘орма–асш = —оздатьќбъект("–асширение‘ормы"); 
	‘орма–асш.”становить‘орму( онт.‘орма);
	“з—канов=‘орма–асш.ѕолучитьјтрибут(»дјтр);
	“з—канов=“з—канов.«начение;
	

	//*(MA)@TOC, [bug/1] 2020-11-26 14:25:54
	//	ѕопытка
	//		“екƒок =  онт.“екущийƒокумент();
	//		≈сли (“ип«начени€(“екƒок)<>12) “огда // “ип =12 - ƒокумент
	//			¬озврат "";
	//		 онец≈сли;
	//	»сключение
	//		¬озврат "";
	//	 онецѕопытки;
	// -------- заменено на:
	“екќбъект = ѕолучить—сылку( онт);
	≈сли “екќбъект = "" “огда
		¬озврат "";
	 онец≈сли;
	///(MA)@TOC, [bug/1] 2020-11-26 14:25:54

	

	//*(MA)@TOC, [bug/1] 2020-11-26 14:19:55
	//	≈сли “екƒок.¬ыбран()=0 “огда
	//		ѕредупреждение("ѕрежде запишите или проведите текущий документ",5);
	// -------- заменено на:
	≈сли “екќбъект.¬ыбран()=0 “огда
		ѕредупреждение("ѕрежде запишите или проведите текущий объект",5);
	///(MA)@TOC, [bug/1] 2020-11-26 14:19:55

		//—ообщить("ѕрежде запишите или проведите текущий документ","i");	
		¬озврат "";
	 онец≈сли; 

	≈сли “з—канов. оличество—трок()<=0 “огда
		// Ќечего
		ѕредупреждение("Ќечего смотреть/печатать",5);
		//—ообщить("Ќечего смотреть/печатать","i");	
		¬озврат "";
	 онец≈сли;
	
	“ек—тр=“з—канов.“екуща€—трока();
	“ек ол=“з—канов.“екуща€ олонка();
	
	≈сли (“ек—тр<=0) »Ћ» (“ек—тр>“з—канов. оличество—трок()) “огда
		// Ќечего
		¬озврат "";
	 онец≈сли;
	
	»м€‘айла=—окрЋѕ(“з—канов.ѕолучить«начение(“ек—тр,"ѕуть"));
	ѕуть ‘айлу=»м€ѕапкиƒл€—канов+"\"+»м€‘айла;
	
	≈сли (‘—.—уществует‘айл(ѕуть ‘айлу)>=1) » (ѕуста€—трока(»м€‘айла)=0) “огда
		«апуститьѕриложение(ѕуть ‘айлу);
	»наче                       
		≈сли ѕуста€—трока(»м€‘айла)>0 “огда
			ѕредупреждение("Ќе задан файл скана",5);
			//—ообщить("Ќе задан файл скана","i");	
		»наче
			ѕредупреждение("Ќе найден файл: "+ѕуть ‘айлу,5);
			//—ообщить("Ќе найден файл: "+ѕуть ‘айлу,"i");	
		 онец≈сли;
	 онец≈сли;
	
	¬озврат "";
 онец‘ункции	// ѕросмотр—кана»з“«—кановƒоковЌа‘орме
//-------------------------------------------------------

‘ункци€ “екуща€—трока“«( онт,»дјтр) Ёкспорт
	
	‘орма–асш = —оздатьќбъект("–асширение‘ормы"); 
	‘орма–асш.”становить‘орму( онт.‘орма);
	“з—канов=‘орма–асш.ѕолучитьјтрибут(»дјтр);
	“з—канов=“з—канов.«начение;
	
	≈сли “з—канов. оличество—трок() = 0 “огда
		¬озврат "";
	 онец≈сли;	
	
	“ек—тр=“з—канов.“екуща€—трока();
	“ек ол=“з—канов.“екуща€ олонка();
	
	»м€‘айла=—окрЋѕ(“з—канов.ѕолучить«начение(“ек—тр,"ѕуть"));
	ѕуть ‘айлу=»м€ѕапкиƒл€—канов+"\"+»м€‘айла;
	
	≈сли (‘—.—уществует‘айл(ѕуть ‘айлу)>=1) » (ѕуста€—трока(»м€‘айла)=0) “огда
		
		 артинка = —оздатьќбъект(" артинка");
		 артинка.«агрузить(ѕуть ‘айлу);
		 артинка.–ежим–исовани€(3);
		фд_ артинка = ‘орма–асш.ѕолучитьјтрибут(»д артинки);
		фд_ артинка.«начение.”становить артинку( артинка);
		
	 онец≈сли;	
	
 онец‘ункции	

//-------------------------------------------------------
‘ункци€ ƒобавитьƒоп√лобћодуль() Ёкспорт
	—ервис=—оздатьќбъект("—ервис");
	“екст√лобћодул€="
	|ѕерем __ лассѕодсистемы—каныƒоков_”становлен Ёкспорт;
	|‘ункци€ "+»д√лоб‘ункции+"( онт,»д“«,»д н) Ёкспорт
	|	__об__—каныƒоков__=—оздатьќбъект("""+»д ласса+"""); 
	|	≈сли »д н="""+»д нѕросмотр+""" “огда
	|		__об__—каныƒоков__.ѕросмотр—кана»з“«—кановƒоковЌа‘орме( онт,»д“«);
	|	»наче≈сли »д н="""+»д н–едактировать+""" “огда	
	|		__об__—каныƒоков__.–едактировать—кан»з“«—кановƒоковЌа‘орме( онт,»д“«);
	|	»наче≈сли »д н="""+»д н”далить+""" “огда		
	|		__об__—каныƒоков__.”далить—кан»з“«—кановƒоковЌа‘орме( онт,»д“«);
	|	»наче≈сли »д н="""+»д нЌовый+""" “огда		
	|		__об__—каныƒоков__.Ќовый—кан¬“«—кановƒоковЌа‘орме( онт,»д“«);
	|	»наче≈сли »д н="""+»д нќбновить+""" “огда		
	|		__об__—каныƒоков__.ќбновить“«—кановƒоковЌа‘орме( онт,»д“«);
	|	»наче≈сли »д н="""+»д“«—канов+""" “огда		
	|		__об__—каныƒоков__.ѕросмотр—кана»з“«—кановƒоковЌа‘орме( онт,»д“«); 
	|	»наче≈сли »д н="""+»д“екст“екуща€—трока“«+""" “огда		
	|		__об__—каныƒоков__.“екуща€—трока“«( онт,»д“«); 
	|	 онец≈сли;
	|	__об__—каныƒоков__=0; ¬озврат """";	
	| онец‘ункции	// 	"+»д√лоб‘ункции+"
	|";
	—ервис.ƒобавить√лобальныйћодуль(“екст√лобћодул€);
	—ервис=0;
	≈сли ‘—.—уществует‘айл(»м€ѕапкиƒл€—канов)<=0 “огда
		‘—.—оздать аталог(»м€ѕапкиƒл€—канов);
	 онец≈сли;
	
	¬озврат “екст√лобћодул€;
 онец‘ункции	// ƒобавитьƒоп√лобћодуль
//-------------------------------------------------------

//-------------------------------------------------------
‘ункци€ —жатьѕапку—канов() Ёкспорт
	–ез=0; —ч”д=0;
	—ообщить("----- ”борщик сканов [Ќачало] -----");		
	—ообщить("[ѕапка сканов]: "+»м€ѕапкиƒл€—канов+"\");		

	≈сли ‘—.—уществует‘айл(»м€ѕапкиƒл€—канов)<=0 “огда
		‘—.—оздать аталог(»м€ѕапкиƒл€—канов);
		—ообщить("[¬сего удалено]: "+—ч”д+" файла, размером "+–ез+" байт");			
		—ообщить("----- ”борщик сканов [ онец] ------");		
		¬озврат –ез;
	 онец≈сли;
	‘—.”ст“ек аталог(»м€ѕапкиƒл€—канов);

	“ек‘айл=—окрЋѕ(‘—.Ќайтиѕервый‘айл("*.*"));
	«апрос=—оздатьќбъект("«апрос");
	ѕока “ек‘айл<>"" ÷икл
		—ч=1+—ч;
		≈сли —ч=1 “огда
		»наче
			“ек‘айл=—окрЋѕ(‘—.Ќайти—ледующий‘айл());	
		 онец≈сли;
		
		≈сли ѕуста€—трока(“ек‘айл)>0 “огда		
			ѕрервать;
		»наче≈сли (“ек‘айл=".") »Ћ» (“ек‘айл="..") “огда	
			ѕродолжить;
		 онец≈сли; 
		
		—осто€ние("ќбработка файлов: "+—ч);

		“екст«апроса="
		|— '01.01.1970' ѕо '"+–абоча€ƒата()+"';
		|ќбрабатыватьƒокументы ¬се;
		|Ѕез итогов;
		|ѕуть=ƒокумент."+»д¬идаƒоковƒл€—канов+".ѕуть;
		|√руппировка —трокаƒокумента;
		|”словие(—окрЋѕ(ѕуть)="""+“ек‘айл+""");
		|";
		≈сли «апрос.¬ыполнить(“екст«апроса)=0 “огда
			ѕродолжить;
		 онец≈сли;
		
		≈сли «апрос.√руппировка()=1 “огда
			ѕродолжить;
		 онец≈сли;  
        
		//ƒелаем манипул€ции с файлом, мер€ем его размер,
		//накапливаем размер файлов, удал€ем
		FileSize=0; Attr=""; ‘—.јтрибуты‘айла(»м€ѕапкиƒл€—канов+"\"+“ек‘айл, FileSize,Attr); 
		FileSize=„исло(?(„исло(FileSize)<(-1),-1*„исло(FileSize),FileSize)); 
		Attr=—окрЋѕ(Attr);
		≈сли —ред(Attr,4,1)="1" “огда
			ѕродолжить;
		 онец≈сли;
		
		‘—.”далить‘айл(»м€ѕапкиƒл€—канов+"\"+“ек‘айл);
		–ез=FileSize+–ез;
		—ч”д=1+—ч”д; 

		—ообщить("‘айл удален: "+“ек‘айл,"i");
	 онец÷икла;
	
	‘—.”ст“ек аталог(‘—.Windows аталог());
	
	—осто€ние("");
	—ообщить("[¬сего удалено]: "+—ч”д+" файла, размером "+–ез+" байт");			
	—ообщить("----- ”борщик сканов [ онец] ------");		
	¬озврат –ез;
 онец‘ункции	// —жатьѕапку—канов
//-------------------------------------------------------

/////////////////////////////////////////////////////////
//********** —лужебные процедуры и функции ************//
/////////////////////////////////////////////////////////

//-------------------------------------------------------
‘ункци€ GetThis( онт) ¬озврат  онт;  онец‘ункции
//-------------------------------------------------------

//-------------------------------------------------------
‘ункци€ ≈стьѕодчиненныеƒоки—канов”ƒока(ƒок)
	“екƒок=ƒок;
	≈сли (“ип«начени€(“екƒок)<>12) “огда // “ип =12 - ƒокумент
		¬озврат 0;
	 онец≈сли;
	≈сли “екƒок.¬ыбран()=0 “огда
		¬озврат 0;
	 онец≈сли; 

	—каныƒоков=—оздатьќбъект("ƒокумент");
	—каныƒоков.¬ыбратьѕодчиненныеƒокументы(,,“екƒок);
	ѕока —каныƒоков.ѕолучитьƒокумент() = 1 ÷икл
		≈сли —каныƒоков.¬ыбран()<=0 “огда
			ѕродолжить;
		 онец≈сли;
		≈сли —каныƒоков.¬ид()<>»д¬идаƒоковƒл€—канов “огда
			ѕродолжить;
		 онец≈сли;
		≈сли —каныƒоков.ѕометка”далени€()>0 “огда
			ѕродолжить;
		 онец≈сли;
		
		¬озврат 1;
	 онец÷икла;
	
	¬озврат 0;
 онец‘ункции	// ≈стьѕодчиненныеƒоки—канов”ƒока
//-------------------------------------------------------

//-------------------------------------------------------
‘ункци€ ¬ернутьƒес€тичное„ислоѕо—имволуƒл€ѕроизвольной—истемы—числени€(«нач —имвол)
	—имвол=¬рег(Ћев(—имвол,1));
	¬озврат „исло(?((„исло(—имвол)<10) » („исло(—имвол)>=1),—имвол,
				?(—имвол="0",—имвол,
				?(—имвол="A",10,
				?(—имвол="B",11,
				?(—имвол="C",12,
				?(—имвол="D",13,
				?(—имвол="E",14,
				?(—имвол="F",15,
				?(—имвол="G",16,
				?(—имвол="H",17,
				?(—имвол="I",18,
				?(—имвол="J",19,
				?(—имвол="K",20,
				?(—имвол="L",21,
				?(—имвол="M",22,
				?(—имвол="N",23,
				?(—имвол="O",24,
				?(—имвол="P",25,
				?(—имвол="Q",26,
				?(—имвол="R",27,
				?(—имвол="S",28,
				?(—имвол="T",29,
				?(—имвол="U",30,
				?(—имвол="V",31,
				?(—имвол="W",32,
				?(—имвол="X",33,
				?(—имвол="Y",34,
				?(—имвол="Z",35,
				"")))))))))))))))))))))))))))));
 онец‘ункции	// ¬ернутьƒес€тичное„ислоѕо—имволуƒл€ѕроизвольной—истемы—числени€
//-------------------------------------------------------

//-------------------------------------------------------
‘ункци€ ѕеревод»зѕроизвольной—истемы—числени€¬ƒес€тичную(«нач —трокаƒл€ѕеревода, «нач ќснование„исла=2, «нач ѕогрешность=0)
	–ез=0; –ез÷ел=0; –езƒроб=0;
	—трокаƒл€ѕеревода=—окрЋѕ(—трокаƒл€ѕеревода);
	—трокаƒл€ѕеревода=—тр«аменить(—трокаƒл€ѕеревода,",",".");
	флќтрицательное=?(Ћев(—трокаƒл€ѕеревода,1)="-",1,0);
	—трокаƒл€ѕеревода=?(флќтрицательное=1,ѕрав(—трокаƒл€ѕеревода,—трƒлина(—трокаƒл€ѕеревода)-1),—трокаƒл€ѕеревода);
	≈сли (ѕуста€—трока(—трокаƒл€ѕеревода)>0) “огда
		¬озврат –ез;
	 онец≈сли;
	
	ќснование„исла=÷ел(„исло(ќснование„исла));
	ќснование„исла=?((ќснование„исла>36) »Ћ» (ќснование„исла<2),2,ќснование„исла);
	ѕогрешность=÷ел(„исло(ѕогрешность));
	ѕогрешность=?(ѕогрешность<0,0,ѕогрешность);
	//ѕогрешность=?(ѕогрешность>20,20,ѕогрешность);
	
	ѕоз“чк=Ќайти(—трокаƒл€ѕеревода,".");
	≈сли ѕоз“чк>0 “огда
		—тр÷ел=Ћев(—трокаƒл€ѕеревода,Ќайти(—трокаƒл€ѕеревода,".")-1);
		—трƒроб=ѕрав(—трокаƒл€ѕеревода,—трƒлина(—трокаƒл€ѕеревода)-—трƒлина(—тр÷ел)-1);
	»наче
		—тр÷ел=—трокаƒл€ѕеревода;
		—трƒроб="";
	 онец≈сли;
	
	ƒл€ —ч=1 ѕо —трƒлина(—тр÷ел) ÷икл
		 –ез÷ел=–ез÷ел*ќснование„исла+¬ернутьƒес€тичное„ислоѕо—имволуƒл€ѕроизвольной—истемы—числени€(—ред(—тр÷ел,—ч,1));
	 онец÷икла;
	
	ƒл€ —ч=1 ѕо —трƒлина(—трƒроб) ÷икл
		—теп=ќснование„исла;
		ƒл€ —ч2=1 ѕо —ч-1 ÷икл
			—теп=—теп*ќснование„исла;
		 онец÷икла;
		—теп=1/—теп;
		–езƒроб=–езƒроб+¬ернутьƒес€тичное„ислоѕо—имволуƒл€ѕроизвольной—истемы—числени€(—ред(—трƒроб,—ч,1))*—теп;
	 онец÷икла;
	
	–езƒроб=„исло(Ћев(—трока(–езƒроб),ѕогрешность+2));
	–ез=–ез÷ел+–езƒроб;
	–ез=?(флќтрицательное=1,-1*–ез,–ез);
	
	¬озврат –ез;	
 онец‘ункции	// ѕеревод»зѕроизвольной—истемы—числени€¬ƒес€тичную
//-------------------------------------------------------

//-------------------------------------------------------
‘ункци€ ¬ернуть—имволѕоƒес€тичному„ислуƒл€–имской—истемы—числени€(«нач „исл)
	„исл=÷ел(„исл); „исл=?(„исл<0,-1*„исл,„исл);
	¬озврат —трока(?(„исл=1,"I",
					?(„исл=2,"II",
					?(„исл=3,"III",
					?(„исл=4,"IV",
					?(„исл=5,"V",
					?(„исл=6,"VI",
					?(„исл=7,"VII",
					?(„исл=8,"VIII",
					?(„исл=9,"IX",
					?(„исл=10,"X",
					?(„исл=20,"XX",
					?(„исл=30,"XXX",
					?(„исл=40,"XL",
					?(„исл=50,"L",
					?(„исл=60,"LX",
					?(„исл=70,"LXX",
					?(„исл=80,"LXXX",
					?(„исл=90,"XC",
					?(„исл=100,"C",
					?(„исл=200,"CC",
					?(„исл=300,"CCC",
					?(„исл=400,"CD",
					?(„исл=500,"D",
					?(„исл=600,"DC",
					?(„исл=700,"DCC",
					?(„исл=800,"DCCC",
					?(„исл=900,"CM",
					?(„исл=1000,"M",""
					)))))))))))))))))))))))))))));
 онец‘ункции	// ¬ернуть—имволѕоƒес€тичному„ислуƒл€–имской—истемы—числени€
//-------------------------------------------------------

//-------------------------------------------------------
‘ункци€ ѕеревод»зƒес€тичной¬–имскую—истему—числени€(«нач „ислоƒл€ѕеревода)
	–ез="";
	„ислоƒл€ѕеревода=÷ел(„ислоƒл€ѕеревода);
	„ислоƒл€ѕеревода=?(„ислоƒл€ѕеревода<0,-1*„ислоƒл€ѕеревода,„ислоƒл€ѕеревода);
	
	—тр„исло=—трока(„ислоƒл€ѕеревода);
	
	≈сли („ислоƒл€ѕеревода=0) »Ћ» (ѕуста€—трока(—тр„исло)>0) “огда
		¬озврат –ез;
	 онец≈сли;
	
	—ч“ыс=0;
	≈сли —трƒлина(—тр„исло)>3 “огда
		—ч“ыс=„исло(Ћев(—тр„исло,—трƒлина(—тр„исло)-3));
		—тр„исло=ѕрав(—тр„исло,3);
	 онец≈сли;
	ƒл€ —ч=1 ѕо —ч“ыс ÷икл
		–ез=–ез+¬ернуть—имволѕоƒес€тичному„ислуƒл€–имской—истемы—числени€(1000);
	 онец÷икла;
	
	—ч—от=0;
	≈сли —трƒлина(—тр„исло)>2 “огда
		—ч—от=„исло(Ћев(—тр„исло,1))*100;
		—тр„исло=ѕрав(—тр„исло,2);
	 онец≈сли;
	–ез=–ез+¬ернуть—имволѕоƒес€тичному„ислуƒл€–имской—истемы—числени€(—ч—от);
    
	—чƒес=0;
	≈сли —трƒлина(—тр„исло)>1 “огда
		—чƒес=„исло(Ћев(—тр„исло,1))*10;
		—тр„исло=ѕрав(—тр„исло,1);
	 онец≈сли;
	–ез=–ез+¬ернуть—имволѕоƒес€тичному„ислуƒл€–имской—истемы—числени€(—чƒес);
	
	—ч≈д=0;
	≈сли —трƒлина(—тр„исло)>0 “огда
		—ч≈д=„исло(Ћев(—тр„исло,1));
		—тр„исло=ѕрав(—тр„исло,1);
	 онец≈сли;
	–ез=–ез+¬ернуть—имволѕоƒес€тичному„ислуƒл€–имской—истемы—числени€(—ч≈д);
	
	¬озврат –ез;
 онец‘ункции	// ѕеревод»зƒес€тичной¬–имскую—истему—числени€
//-------------------------------------------------------

//-------------------------------------------------------
// ‘ункци€ проверки включен ли режим закладок на форме
// ‘орма.»спользовать«акладки(1);
// ¬озвращает 0 - если нет, 1 - если да.
// » -1 - если в функцию передан не групповой контекст.
‘ункци€ «акладки¬ключены( онт)
	–ез=0;
	≈сли “ип«начени€—тр( онт) <> "√рупповой онтекст" “огда
		–ез=-1;
		¬озврат –ез;
	 онец≈сли;

	ѕопытка	
		–ез= онт.‘орма.«акладки.–азмер—писка();
		–ез=1;
	»сключение
		–ез=0;
	 онецѕопытки;	
	
	¬озврат –ез;
 онец‘ункции	// «акладки¬ключены
//-------------------------------------------------------

//-------------------------------------------------------
// ‘ункци€ возвращает кол-во закладок на форме
‘ункци€ «акладки ол¬о( онт)
	–ез=0;
	
	–ез=«акладки¬ключены( онт);
	
	≈сли –ез=1 “огда
		–ез= онт.‘орма.«акладки.–азмер—писка();
	 онец≈сли;
	
	¬озврат –ез;
 онец‘ункции	// «акладки ол¬о
//-------------------------------------------------------

//-------------------------------------------------------
// ‘ункци€ возвращает список слоев на форме
// “олько если на слое есть хот€ бы один контрол
// ћожет включать в возвращаемый список слоев - все
// или только видимые, оп€ть же видимость сло€ определ€етс€
// по контролам, которые видимы и принадлежат слою.
// “.е. "пустые" слои без контролов учитыватьс€ не будут.
‘ункци€ —лоиѕолучить—писок( онт,“олько¬идимые=0)
	–ез=—оздатьќбъект("—писок«начений");
	≈сли “ип«начени€—тр( онт) <> "√рупповой онтекст" “огда
		//–ез=-1;
		¬озврат –ез;
	 онец≈сли;
	“олько¬идимые=„исло(“олько¬идимые);

	‘орма–асш=—оздатьќбъект("–асширение‘ормы");
	‘орма–асш.”становить‘орму( онт.‘орма);
	—писок—лоев=—оздатьќбъект("—писок«начений");
	
	ƒл€ —ч=0 ѕо ‘орма–асш. оличествојтрибутов()-1 ÷икл
		јтр=‘орма–асш.ѕолучитьјтрибут(—ч);
		—лой=јтр.—лой; 
		
		≈сли “олько¬идимые=0 “огда
			≈сли —писок—лоев.Ќайти«начение(—лой)=0 “огда
				—писок—лоев.ƒобавить«начение(—лой);
			 онец≈сли;
		»наче
			//≈сли (јтр.¬идимость=1) » (—писок—лоев.Ќайти«начение(—лой)=0) “огда
			≈сли („исло(—ред(ѕеревод»зѕроизвольной—истемы—числени€¬ƒес€тичную(јтр.—тиль,2,0),3,1))=1) » 
					(—писок—лоев.Ќайти«начение(—лой)=0) “огда
				—писок—лоев.ƒобавить«начение(—лой);
			 онец≈сли;
		 онец≈сли;
	 онец÷икла;
	
	—писок—лоев.¬ыгрузить(–ез);
	
	¬озврат –ез;
 онец‘ункции	// —лоиѕолучить—писок
//-------------------------------------------------------
