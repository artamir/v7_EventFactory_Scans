Перем _База;

Функция Сам(Конт)
	Возврат Конт;
КонецФункции
    
// -------------------------------- -------------------------------------
Процедура Конструктор()                                   
	_База = Сам(Контекст).ПолучитьБазовыйКласс();
КонецПроцедуры // Конструктор

Функция СЗ() Экспорт
	Возврат _База;
КонецФункции

Функция ВсеВСтрокуСРазделителями() Экспорт
	Возврат ЗначениеВСтрокуВнутр(_База);
КонецФункции

Функция ВСтроку() Экспорт
	Возврат ВсеВСтрокуСРазделителями();
КонецФункции

Процедура ВсеИзСтрокиСРазделителями(Строк) Экспорт
	Пром = ЗначениеИзСтрокиВнутр(Строк);
	Пром.Выгрузить(_База);
КонецПроцедуры

Процедура ИзСтроки(Строк) Экспорт
	ВсеИзСтрокиСРазделителями(Строк);
КонецПроцедуры

Процедура ИзСпискаЗначений(Список) Экспорт
	Список.Выгрузить(_База);
	     
	лТекущаяСтрока = Список.ТекущаяСтрока();
	Если лТекущаяСтрока <> 0 Тогда
		_База.ТекущаяСтрока(лТекущаяСтрока);
	КонецЕсли;
КонецПроцедуры

Функция ВСписокЗначений() Экспорт
	Результат=СоздатьОбъект("СписокЗначений");
	_База.Выгрузить(Результат);	
	     
	лТекущаяСтрока = _База.ТекущаяСтрока();
	Если лТекущаяСтрока <> 0 Тогда
		Результат.ТекущаяСтрока(лТекущаяСтрока);
	КонецЕсли;

	Возврат Результат;
КонецФункции

Процедура ИзТаблицыЗначений(Таблица) Экспорт
	_База.УдалитьВсе();
	
	Таблица.ВыбратьСтроки();
	Пока Таблица.ПолучитьСтроку()=1 Цикл
		_База.ДобавитьЗначение(Таблица.Значение,Таблица.Представление);
	КонецЦикла;
КонецПроцедуры

Функция ВТаблицуЗначений(Таблица=0, Мягко=0) Экспорт
	Если Таблица=0 Тогда
		Таблица=СоздатьОбъект("ТаблицаЗначений");
	КонецЕсли;
	Если Мягко=0 Тогда
		Таблица.Очистить();
		Таблица.НоваяКолонка("Значение");
		Таблица.НоваяКолонка("Представление","Строка");
	Иначе
		ЕстьЗначение=0;
		ЕстьПредставление=0;
		Для К=1 По Таблица.КоличествоКолонок() Цикл
			ИдентификаторКолонки=Таблица.ПолучитьПараметрыКолонки(К);
			Если ИдентификаторКолонки="Значение" Тогда
				ЕстьЗначение=1
			ИначеЕсли ИдентификаторКолонки="Представление" Тогда
				ЕстьПредставление=1;
			КонецЕсли;
		КонецЦикла;
		
		Если ЕстьЗначение=0 Тогда
			Таблица.НоваяКолонка("Значение");
		КонецЕсли;
		Если ЕстьПредставление=0 Тогда
			Таблица.НоваяКолонка("Представление");
		КонецЕсли;
	КонецЕсли;

	Для С=1 По _База.РазмерСписка() Цикл
		Представление="";
		Значение=_База.ПолучитьЗначение(С,Представление);
		Таблица.НоваяСтрока();
		Таблица.Значение=Значение;
		Таблица.Представление=Представление;
	КонецЦикла;
	
	Возврат Таблица;
КонецФункции

Процедура ИзСтрокиТЗ(Таблица,НомСтроки) Экспорт
	_База.УдалитьВсе();
	Для К=1 По Таблица.КоличествоКолонок() Цикл
		Значение=Таблица.ПолучитьЗначение(НомСтроки,К);
		Представление=Таблица.ПолучитьПараметрыКолонки(К);
		_База.ДобавитьЗначение(Значение,Представление);
	КонецЦикла;
КонецПроцедуры

Функция НайтиПоПредставлению(Представление) Экспорт
	Значение=_База.Получить(Представление);
	Возврат _База.НайтиЗначение(Значение);
КонецФункции

// добавлю работу с пометками

Процедура ИзТаблицыЗначенийВместеСПометками(Таблица) Экспорт
	Сам(Контекст).ИзТаблицыЗначений(Таблица);
	           
	лФлагУстановкиТекущейСтроки = 0;
	Таблица.ВыбратьСтроки();
	Пока Таблица.ПолучитьСтроку()=1 Цикл
		_База.Пометка(Таблица.НомерСтроки, Таблица.Пометка);
		Если лФлагУстановкиТекущейСтроки = 0 Тогда
			Если Таблица.ТекущаяСтрока = 1 Тогда
				_База.ТекущаяСтрока(Таблица.НомерСтроки);
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
КонецПроцедуры

Функция ВТаблицуЗначенийВместеСПометками(Таблица=0, Мягко=0) Экспорт
	Сам(Контекст).ВТаблицуЗначений(Таблица, Мягко);
	
	Если Мягко=0 Тогда
		Таблица.НоваяКолонка("Пометка","Число", 1,,,10);
		Таблица.НоваяКолонка("ТекущаяСтрока","Число", 1,,,10);
	Иначе
		ЕстьПометка=0;
		Для К=1 По Таблица.КоличествоКолонок() Цикл
			ИдентификаторКолонки=Таблица.ПолучитьПараметрыКолонки(К);
			Если ИдентификаторКолонки="Пометка" Тогда
				ЕстьПометка=1
			КонецЕсли;
		КонецЦикла;
		
		Если ЕстьПометка=0 Тогда
			Таблица.НоваяКолонка("Пометка");
		КонецЕсли;
	КонецЕсли;

	Для С=1 По Сам(Контекст).РазмерСписка() Цикл
		лПометка = Сам(Контекст).Пометка(С);
		Таблица.УстановитьЗначение(С, "Пометка", лПометка);
	КонецЦикла;              
	
	лТекущаяСтрока = Сам(Контекст).ТекущаяСтрока();
	Если лТекущаяСтрока <> 0 Тогда
		Таблица.УстановитьЗначение(лТекущаяСтрока, "ТекущаяСтрока", 1);
	КонецЕсли;

	Возврат Таблица;
КонецФункции
