// получить реквизиты справочников, которые изменены документом

//******************************************************************************
//	РеквизитыСправочников()
//
//	Параметры:
//		нет
//
//	Описание:
//		
//
Процедура РеквизитыСправочников(ВыбДокумент, Таб)
	
	Периодический = СоздатьОбъект("Периодический");
	Если Периодический.ВыбратьПоДокументу(ВыбДокумент)=1 Тогда
		Таб.НоваяКолонка("ВидСправочника", "Строка");
		Таб.НоваяКолонка("ЭлементСправочника", "Справочник");
		Таб.НоваяКолонка("Реквизит", "Строка");
		Таб.НоваяКолонка("ДатаЗнач", "Дата");
		Таб.НоваяКолонка("Значение");

		ВидСправочника = "";
		ЭлементСправочника = "";
		Пока Периодический.ПолучитьЗначение()=1 Цикл
			Если ЭлементСправочника<>Периодический.ТекущийОбъект() Тогда
				ЭлементСправочника = Периодический.ТекущийОбъект();
			КонецЕсли;
			Если ВидСправочника<>ЭлементСправочника.Вид() Тогда
				ВидСправочника = ЭлементСправочника.Вид();
			КонецЕсли;
			
			Таб.НоваяСтрока();
			Таб.ВидСправочника = ВидСправочника;
			Таб.ЭлементСправочника = ЭлементСправочника;
			Таб.Реквизит = Строка(Метаданные.Справочник(ВидСправочника).Реквизит(СтрЗаменить(Периодический.ТекущийРеквизит(),ВидСправочника+".","")));
			Таб.ДатаЗнач = Периодический.ДатаЗнач;
			Таб.Значение = Периодический.Значение;
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры	// РеквизитыСправочников

Функция Выполнить(Тест) Экспорт

	Результат=СоздатьОбъект("ТаблицаЗначений");
         
	ВыбДокумент = Тест.ОбъектТестирования();
	
	Если ВыбДокумент.Выбран()=0 Тогда
		Возврат Результат;
	КонецЕсли;
	
	Если ВыбДокумент.Проведен()=0 Тогда
		Стр = "Документ не проведен !!";
		Результат.НоваяКолонка("Колонка", "Строка");
		Результат.НоваяСтрока();
		Результат.Колонка = Стр;
		Возврат Результат;
	КонецЕсли;
	
	Периодический = СоздатьОбъект("Периодический");
	Если (Периодический.ВыбратьПоДокументу(ВыбДокумент)=0) Тогда
		Стр = "Выберите документ, устанавливающий реквизиты справочников!";
		Результат.НоваяКолонка("Колонка", "Строка");
		Результат.НоваяСтрока();
		Результат.Колонка = Стр;
		Возврат Результат;
	КонецЕсли;
	
	РеквизитыСправочников(ВыбДокумент, Результат);
	
	Возврат Результат;

КонецФункции